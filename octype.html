<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KPL Pick & Ban Overlay</title>
  <style>
    :root{
      --bg-top: #061325;
      --bg-main: #050916;
      --accent-blue: #31c3ff;
      --accent-red: #ff7b4a;
      --text-soft: #e6f4ff;
      --muted: #7f8da3;
      /* GIẢM RỘNG CARD ĐỂ TẠO KHOẢNG CÁCH GIỮA HAI BÊN */
      --card-w: 128px;
      --card-h: 176px;
      --ban-w: 56px;
      --ban-h: 56px;
      --radius: 10px;
      --pulse: 0 0 12px rgba(255,255,255,0.7);
    }
    *{box-sizing:border-box}
    html,body{
      height:100%;margin:0;
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
      color:var(--text-soft);
      background:transparent;
    }
    body{
      display:flex;justify-content:center;align-items:flex-start;
      padding:8px;
    }
    .wrap{
      width:1600px;          /* 1600 cho OBS crop 1920 vẫn đẹp */
      max-width:100%;
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    /* ====== OVERLAY ====== */
    .overlay{
      position:relative;
      width:100%;
      padding:10px 16px 16px;
      border-radius:14px;
      background:radial-gradient(circle at 50% 0, #253b62 0, #050816 55%, #02030a 100%);
      box-shadow:0 16px 40px rgba(0,0,0,0.85);
      overflow:hidden;
    }

    /* Top bar: bans + team names + score */
    .top-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:8px;
    }
    .team-top{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:360px;
    }
    .team-logo{
      width:38px;height:38px;border-radius:999px;
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.18);
      display:flex;align-items:center;justify-content:center;
      overflow:hidden;
    }
    .team-logo img{width:100%;height:100%;object-fit:contain}
    .team-name{
      font-size:18px;
      font-weight:600;
      letter-spacing:0.03em;
      white-space:nowrap;
    }
    .team-name[contenteditable="true"]{
      outline:none;
      border-bottom:1px dashed transparent;
    }
    .team-name:focus{border-bottom-color:rgba(255,255,255,0.4)}

    .bans-row{
      display:flex;
      gap:6px;
      margin-left:12px;
    }
    .ban-slot{
      width:var(--ban-w);
      height:var(--ban-h);
      border-radius:6px;
      background:linear-gradient(135deg,rgba(255,255,255,0.03),rgba(0,0,0,0.6));
      border:1px solid rgba(255,255,255,0.18);
      overflow:hidden;
      position:relative;
    }
    .ban-slot img{
      width:100%;height:100%;object-fit:cover;filter:saturate(0.8);
    }
    .ban-slot::after{
      content:"";
      position:absolute;inset:0;
      background:linear-gradient(45deg,rgba(0,0,0,0.45),rgba(0,0,0,0.1));
      mix-blend-mode:multiply;
      pointer-events:none;
    }

    .score-block{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:2px;
      min-width:120px;
    }
    .score-text{
      font-size:30px;
      font-weight:800;
      letter-spacing:0.08em;
      text-shadow:0 0 8px rgba(0,0,0,0.8);
    }
    .score-text span{
      padding:0 4px;
    }
    .series-label{
      font-size:12px;
      text-transform:uppercase;
      color:var(--muted);
    }

    /* Middle logo (SVG) */
    .center-logo{
      position:absolute;
      inset:50% auto auto 50%;
      transform:translate(-50%,-40%);
      pointer-events:none;
      opacity:0.17;
    }
    .center-logo svg{width:160px;height:auto}

    /* Picks row – CHỈNH ĐỂ HAI BÊN CÂN VÀ CÓ KHOẢNG CÁCH GIỮA */
    .picks-row{
      position:relative;
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      margin-top:18px;
      padding:0 40px;
    }
    .picks-side{
      display:flex;
      gap:10px;
      flex:0 0 calc(var(--card-w)*5 + 40px);
      /* 5 card * 128 + 4 gap 10 = 680; mỗi bên 680, giữa còn ~128px khoảng trống */
    }
    .picks-right{justify-content:flex-end;}
    .picks-left{justify-content:flex-start;}

    .pick-slot{
      width:var(--card-w);
      height:var(--card-h);
      border-radius:14px;
      background:linear-gradient(160deg,rgba(255,255,255,0.01),rgba(0,0,0,0.8));
      border:1px solid rgba(255,255,255,0.18);
      overflow:hidden;
      position:relative;
      transform-origin:center bottom;
      display:flex;align-items:flex-end;justify-content:center;
      backdrop-filter:blur(3px);
    }
    .pick-slot-inner{
      position:absolute;inset:0;
      overflow:hidden;
    }
    .pick-slot img{
      width:100%;height:100%;object-fit:cover;
    }
    .pick-name{
      position:absolute;
      left:0;right:0;bottom:0;
      padding:4px 6px 5px;
      background:linear-gradient(180deg,transparent 0,rgba(0,0,0,0.9) 100%);
      font-size:13px;
      font-weight:600;
      text-align:left;
      white-space:nowrap;
      text-overflow:ellipsis;
      overflow:hidden;
    }

    /* Active Turn & picked animation */
    .slot-active{
      box-shadow:var(--pulse);
      animation:pulse 1s ease-in-out infinite;
      border-color:rgba(255,255,255,0.8);
    }
    .slot-picked{
      animation:pop-in 0.35s ease-out;
    }
    @keyframes pulse{
      0%{box-shadow:0 0 0 rgba(255,255,255,0);}
      50%{box-shadow:var(--pulse);}
      100%{box-shadow:0 0 0 rgba(255,255,255,0);}
    }
    @keyframes pop-in{
      0%{transform:scale(0.9) translateY(12px);opacity:0;}
      60%{transform:scale(1.03) translateY(0);opacity:1;}
      100%{transform:scale(1) translateY(0);opacity:1;}
    }

    .picks-left .pick-slot{
      border-image:linear-gradient(180deg,rgba(49,195,255,0.7),rgba(0,0,0,0.4)) 1;
    }
    .picks-right .pick-slot{
      border-image:linear-gradient(180deg,rgba(255,123,74,0.7),rgba(0,0,0,0.4)) 1;
    }

    /* ===== Admin Panel ===== */
    .panel{
      width:100%;
      border-radius:10px;
      padding:10px 12px;
      background:rgba(9,13,25,0.92);
      border:1px solid rgba(255,255,255,0.16);
      box-shadow:0 10px 30px rgba(0,0,0,0.75);
      font-size:13px;
      display:grid;
      grid-template-columns:2fr 3fr 3fr;
      gap:10px;
    }
    .panel h3{
      margin:0 0 6px;
      font-size:14px;
      text-transform:uppercase;
      letter-spacing:0.08em;
      color:var(--muted);
    }
    .panel-section{
      border-right:1px solid rgba(255,255,255,0.08);
      padding-right:10px;
    }
    .panel-section:last-child{border-right:none;padding-right:0;}
    .btn-row{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:6px;}
    button{
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.25);
      background:rgba(255,255,255,0.04);
      color:var(--text-soft);
      padding:4px 10px;
      font-size:12px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:4px;
      transition:background 0.15s,transform 0.1s,border-color 0.15s;
    }
    button:hover{
      background:rgba(255,255,255,0.12);
      transform:translateY(-1px);
    }
    button:active{
      transform:translateY(0);
      background:rgba(255,255,255,0.18);
    }
    .btn-active{
      background:linear-gradient(90deg,var(--accent-blue),var(--accent-red));
      border-color:rgba(255,255,255,0.75);
      color:#02101f;
      font-weight:600;
    }
    label{display:flex;flex-direction:column;gap:4px;margin-bottom:6px;}
    input[type="file"]{
      font-size:11px;
      color:var(--muted);
    }
    input[type="text"]{
      background:rgba(0,0,0,0.6);
      border-radius:6px;
      border:1px solid rgba(255,255,255,0.18);
      padding:3px 6px;
      color:var(--text-soft);
      font-size:12px;
      width:100%;
    }
    .small-note{font-size:11px;color:var(--muted);}
    .turn-indicator{
      font-size:12px;
      color:var(--accent-blue);
      margin-top:4px;
    }

    /* Hero pool frame */
    .hero-pool{
      display:flex;
      flex-wrap:wrap;
      gap:4px;
      max-height:110px;
      padding:4px;
      border-radius:6px;
      border:1px solid rgba(255,255,255,0.15);
      background:rgba(0,0,0,0.55);
      overflow-y:auto;
    }
    .hero-thumb{
      width:40px;
      height:40px;
      border-radius:6px;
      overflow:hidden;
      cursor:pointer;
      border:1px solid transparent;
      position:relative;
    }
    .hero-thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .hero-thumb-active{
      border-color:rgba(255,255,255,0.85);
      box-shadow:0 0 6px rgba(255,255,255,0.9);
    }

    @media(max-width:1024px){
      .panel{
        grid-template-columns:1fr;
      }
      .panel-section{
        border-right:none;
        border-bottom:1px solid rgba(255,255,255,0.08);
        padding-bottom:6px;
        margin-bottom:4px;
      }
      .panel-section:last-child{
        border-bottom:none;
        margin-bottom:0;
        padding-bottom:0;
      }
    }
  </style>
</head>
<body>
<div class="wrap">
  <!-- ================== OVERLAY ================== -->
  <div class="overlay" id="overlay">

    <!-- TOP ROW -->
    <div class="top-row">
      <!-- Left team (Blue) -->
      <div class="team-top" id="team-left">
        <div class="team-logo"><img id="logo-left" alt=""></div>
        <div class="team-name" id="name-left" contenteditable="true">Blue Team</div>
        <div class="bans-row" id="bans-left">
          <div class="ban-slot" data-slot="L-B1"></div>
          <div class="ban-slot" data-slot="L-B2"></div>
          <div class="ban-slot" data-slot="L-B3"></div>
          <div class="ban-slot" data-slot="L-B4"></div>
        </div>
      </div>

      <!-- Score -->
      <div class="score-block">
        <div class="score-text">
          <span id="score-left" contenteditable="true">1</span>
          :
          <span id="score-right" contenteditable="true">0</span>
        </div>
        <div class="series-label">KPL 年度总决赛</div>
      </div>

      <!-- Right team (Red) -->
      <div class="team-top" id="team-right" style="flex-direction:row-reverse;text-align:right;">
        <div class="team-logo"><img id="logo-right" alt=""></div>
        <div class="team-name" id="name-right" contenteditable="true">Red Team</div>
        <div class="bans-row" id="bans-right" style="margin-left:0;margin-right:12px;">
          <div class="ban-slot" data-slot="R-B1"></div>
          <div class="ban-slot" data-slot="R-B2"></div>
          <div class="ban-slot" data-slot="R-B3"></div>
          <div class="ban-slot" data-slot="R-B4"></div>
        </div>
      </div>
    </div>

    <!-- Center SVG logo -->
    <div class="center-logo" aria-hidden="true">
      <svg viewBox="0 0 120 120">
        <defs>
          <linearGradient id="glow" x1="0" x2="1" y1="0" y2="1">
            <stop offset="0%" stop-color="#ffffff" stop-opacity="0.95"/>
            <stop offset="50%" stop-color="#8cd5ff" stop-opacity="0.4"/>
            <stop offset="100%" stop-color="#00a2ff" stop-opacity="0.1"/>
          </linearGradient>
        </defs>
        <circle cx="60" cy="60" r="42" fill="none" stroke="url(#glow)" stroke-width="3"/>
        <path d="M60 24L40 44l6 26 14 12 14-12 6-26z"
              fill="rgba(4,9,20,0.7)" stroke="url(#glow)" stroke-width="2"/>
        <text x="60" y="66" text-anchor="middle" fill="#ffffff"
              font-family="system-ui,Segoe UI" font-size="18" font-weight="700">KPL</text>
      </svg>
    </div>

    <!-- PICKS -->
    <div class="picks-row">
      <!-- Left picks (Blue) -->
      <div class="picks-side picks-left" id="picks-left">
        <div class="pick-slot" data-slot="L-P1">
          <div class="pick-slot-inner"><img alt=""></div>
          <div class="pick-name"></div>
        </div>
        <div class="pick-slot" data-slot="L-P2">
          <div class="pick-slot-inner"><img alt=""></div>
          <div class="pick-name"></div>
        </div>
        <div class="pick-slot" data-slot="L-P3">
          <div class="pick-slot-inner"><img alt=""></div>
          <div class="pick-name"></div>
        </div>
        <div class="pick-slot" data-slot="L-P4">
          <div class="pick-slot-inner"><img alt=""></div>
          <div class="pick-name"></div>
        </div>
        <div class="pick-slot" data-slot="L-P5">
          <div class="pick-slot-inner"><img alt=""></div>
          <div class="pick-name"></div>
        </div>
      </div>

      <!-- Right picks (Red) -->
      <div class="picks-side picks-right" id="picks-right">
        <div class="pick-slot" data-slot="R-P1">
          <div class="pick-slot-inner"><img alt=""></div>
          <div class="pick-name"></div>
        </div>
        <div class="pick-slot" data-slot="R-P2">
          <div class="pick-slot-inner"><img alt=""></div>
          <div class="pick-name"></div>
        </div>
        <div class="pick-slot" data-slot="R-P3">
          <div class="pick-slot-inner"><img alt=""></div>
          <div class="pick-name"></div>
        </div>
        <div class="pick-slot" data-slot="R-P4">
          <div class="pick-slot-inner"><img alt=""></div>
          <div class="pick-name"></div>
        </div>
        <div class="pick-slot" data-slot="R-P5">
          <div class="pick-slot-inner"><img alt=""></div>
          <div class="pick-name"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ================== ADMIN PANEL ================== -->
  <div class="panel" id="admin">
    <!-- Điều khiển lượt -->
    <div class="panel-section">
      <h3>ĐIỀU KHIỂN LƯỢT</h3>
      <div class="btn-row">
        <button id="teamBtnLeft" class="btn-active" data-team="L">Blue (Trái)</button>
        <button id="teamBtnRight" data-team="R">Red (Phải)</button>
      </div>
      <div class="btn-row">
        <button id="modeBan" class="btn-active" data-mode="ban">Chế độ BAN</button>
        <button id="modePick" data-mode="pick">Chế độ PICK</button>
      </div>
      <div class="btn-row">
        <button id="btnNext">Lượt tiếp theo</button>
        <button id="btnClear">Xoá ảnh ô hiện tại</button>
      </div>
      <div class="turn-indicator" id="turnInfo"></div>
    </div>

    <!-- Kho tướng + áp dụng -->
    <div class="panel-section">
      <h3>KHO TƯỚNG & ÁP DỤNG</h3>

      <label>
        Thêm nhiều ảnh tướng (JPG/PNG)
        <input type="file" id="heroPoolFiles" multiple accept="image/*" />
      </label>

      <div class="hero-pool" id="heroPool"></div>

      <label>
        Chọn 1 ảnh riêng lẻ (tuỳ chọn)
        <input type="file" id="heroFile" accept="image/*" />
      </label>
      <label>
        Tên tướng (nếu bỏ trống sẽ lấy theo tên file / kho)
        <input type="text" id="heroName" placeholder="Ví dụ: Lữ Bố" />
      </label>
      <div class="btn-row">
        <button id="btnApply">Áp dụng file riêng vào ô đang tới lượt</button>
      </div>
      <div class="small-note">
        * Bấm vào thumbnail trong <b>Kho tướng</b> là tướng vào ngay ô đang active.  
        * Lượt active nhấp nháy viền sáng, ảnh mới có hiệu ứng nở.
      </div>
    </div>

    <!-- Logo & tuỳ chỉnh -->
    <div class="panel-section">
      <h3>LOGO & TUỲ CHỈNH</h3>
      <label>
        Logo team trái (Blue)
        <input type="file" id="logoFileLeft" accept="image/*" />
      </label>
      <label>
        Logo team phải (Red)
        <input type="file" id="logoFileRight" accept="image/*" />
      </label>
      <label>
        Ghi chú (ví dụ: Game 2 – Bo7)
        <input type="text" id="noteField" placeholder="Game 1 – Bo5" />
      </label>
      <div class="small-note">
        * Tên đội và tỉ số sửa trực tiếp trên overlay.  
        * Có thể crop ẩn phần admin trong OBS khi lên live.
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // ==== THỨ TỰ BAN / PICK THEO YÊU CẦU ====
  // blue = L, red = R
  // ban 1 blue, ban 2 red, ban 3 blue, ban 4 red,
  // pick 1 blue,
  // pick 2 3 red,
  // pick 4 5 blue,
  // pick 6 red,
  // ban 5 red, ban 6 blue, ban 7 red, ban 8 blue,
  // pick 7 red,
  // pick 8 9 blue,
  // pick 10 red
  const order = [
    {type:"ban",  team:"L", slot:"L-B1"},
    {type:"ban",  team:"R", slot:"R-B1"},
    {type:"ban",  team:"L", slot:"L-B2"},
    {type:"ban",  team:"R", slot:"R-B2"},

    {type:"pick", team:"L", slot:"L-P1"},

    {type:"pick", team:"R", slot:"R-P1"},
    {type:"pick", team:"R", slot:"R-P2"},

    {type:"pick", team:"L", slot:"L-P2"},
    {type:"pick", team:"L", slot:"L-P3"},

    {type:"pick", team:"R", slot:"R-P3"},

    {type:"ban",  team:"R", slot:"R-B3"},
    {type:"ban",  team:"L", slot:"L-B3"},
    {type:"ban",  team:"R", slot:"R-B4"},
    {type:"ban",  team:"L", slot:"L-B4"},

    {type:"pick", team:"R", slot:"R-P4"},
    {type:"pick", team:"L", slot:"L-P4"},
    {type:"pick", team:"L", slot:"L-P5"},
    {type:"pick", team:"R", slot:"R-P5"}
  ];

  const allSlots = {};
  document.querySelectorAll("[data-slot]").forEach(el=>{
    allSlots[el.dataset.slot] = el;
  });

  const heroFile = document.getElementById("heroFile");
  const heroNameInput = document.getElementById("heroName");
  const btnApply = document.getElementById("btnApply");
  const btnNext = document.getElementById("btnNext");
  const btnClear = document.getElementById("btnClear");
  const modeBanBtn = document.getElementById("modeBan");
  const modePickBtn = document.getElementById("modePick");
  const teamBtnLeft = document.getElementById("teamBtnLeft");
  const teamBtnRight = document.getElementById("teamBtnRight");
  const turnInfo = document.getElementById("turnInfo");
  const logoLeftInput = document.getElementById("logoFileLeft");
  const logoRightInput = document.getElementById("logoFileRight");
  const logoLeftImg = document.getElementById("logo-left");
  const logoRightImg = document.getElementById("logo-right");
  const noteField = document.getElementById("noteField");

  const heroPoolFilesInput = document.getElementById("heroPoolFiles");
  const heroPool = document.getElementById("heroPool");
  let heroPoolData = [];
  let curIndex = 0;
  let manualTeam = "L";
  let manualMode = "ban";

  function getCurrentTurn(){ return order[curIndex] || null; }

  function clearActive(){
    Object.values(allSlots).forEach(el=>el.classList.remove("slot-active"));
  }

  function applyActiveFromOrder(){
    clearActive();
    const t = getCurrentTurn();
    if(!t) {
      turnInfo.textContent = "Đã hết thứ tự lượt (ban/pick).";
      return;
    }
    const el = allSlots[t.slot];
    if(el){ el.classList.add("slot-active"); }
    turnInfo.textContent =
      `Lượt ${curIndex+1}/${order.length} – ` +
      (t.type==="ban" ? "BAN" : "PICK") +
      ` – Team ${t.team==="L" ? "Blue" : "Red"}`;
  }

  function nextTurn(){
    if(curIndex < order.length-1){
      curIndex++;
      applyActiveFromOrder();
    }else{
      clearActive();
      turnInfo.textContent = "Đã kết thúc tất cả lượt ban & pick.";
    }
  }
  btnNext.addEventListener("click", nextTurn);

  function setTeam(team){
    manualTeam = team;
    if(team === "L"){
      teamBtnLeft.classList.add("btn-active");
      teamBtnRight.classList.remove("btn-active");
    }else{
      teamBtnRight.classList.add("btn-active");
      teamBtnLeft.classList.remove("btn-active");
    }
  }
  function setMode(mode){
    manualMode = mode;
    if(mode === "ban"){
      modeBanBtn.classList.add("btn-active");
      modePickBtn.classList.remove("btn-active");
    }else{
      modePickBtn.classList.add("btn-active");
      modeBanBtn.classList.remove("btn-active");
    }
  }
  teamBtnLeft.addEventListener("click",()=>setTeam("L"));
  teamBtnRight.addEventListener("click",()=>setTeam("R"));
  modeBanBtn.addEventListener("click",()=>setMode("ban"));
  modePickBtn.addEventListener("click",()=>setMode("pick"));

  function getTargetSlot(){
    const active = document.querySelector(".slot-active");
    if(active) return active;

    const prefix = manualTeam === "L" ? "L" : "R";
    const typeChar = manualMode === "ban" ? "B" : "P";
    const candidates = Object.keys(allSlots)
      .filter(k=>k.startsWith(prefix+"-"+typeChar))
      .sort();
    for(const key of candidates){
      const el = allSlots[key];
      const img = el.querySelector("img");
      if(!img || !img.src) return el;
    }
    return allSlots[candidates[0]];
  }

  function applyHeroDataToSlot(slotEl, hero){
    if(!slotEl || !hero) return;
    const isPick = slotEl.classList.contains("pick-slot");
    let img = slotEl.querySelector("img");
    if(!img){
      img = document.createElement("img");
      if(isPick){
        slotEl.querySelector(".pick-slot-inner").appendChild(img);
      }else{
        slotEl.appendChild(img);
      }
    }
    img.src = hero.src;

    if(isPick){
      const nameBox = slotEl.querySelector(".pick-name");
      if(nameBox){
        const overrideName = heroNameInput.value.trim();
        nameBox.textContent = overrideName || hero.name || "";
      }
    }

    slotEl.classList.remove("slot-picked");
    void slotEl.offsetWidth;
    slotEl.classList.add("slot-picked");
  }

  function setImageFromFile(slotEl, file, heroName){
    if(!slotEl || !file) return;
    const reader = new FileReader();
    reader.onload = function(e){
      const hero = {
        src: e.target.result,
        name: heroName || (file.name ? file.name.replace(/\.[^.]+$/,"") : "")
      };
      applyHeroDataToSlot(slotEl, hero);
    };
    reader.readAsDataURL(file);
  }

  btnApply.addEventListener("click",()=>{
    const file = heroFile.files && heroFile.files[0];
    if(!file){
      alert("Hãy chọn một file ảnh tướng (ô bên dưới) trước.");
      return;
    }
    const target = getTargetSlot();
    setImageFromFile(target, file, heroNameInput.value.trim());
  });

  btnClear.addEventListener("click",()=>{
    const target = getTargetSlot();
    if(!target) return;
    const img = target.querySelector("img");
    if(img) img.src = "";
    if(target.classList.contains("pick-slot")){
      const nameBox = target.querySelector(".pick-name");
      if(nameBox) nameBox.textContent = "";
    }
  });

  function setLogo(input, imgEl){
    const file = input.files && input.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = e => imgEl.src = e.target.result;
    reader.readAsDataURL(file);
  }
  logoLeftInput.addEventListener("change",()=>setLogo(logoLeftInput,logoLeftImg));
  logoRightInput.addEventListener("change",()=>setLogo(logoRightInput,logoRightImg));

  noteField.addEventListener("input",()=>{
    console.log("Note:",noteField.value);
  });

  Object.values(allSlots).forEach(el=>{
    el.addEventListener("click",()=>{
      clearActive();
      el.classList.add("slot-active");
    });
  });

  heroPoolFilesInput.addEventListener("change",()=>{
    const files = Array.from(heroPoolFilesInput.files || []);
    files.forEach(file=>{
      const reader = new FileReader();
      reader.onload = e=>{
        const src = e.target.result;
        const name = file.name ? file.name.replace(/\.[^.]+$/,"") : "";
        const index = heroPoolData.length;
        heroPoolData.push({src,name});

        const thumb = document.createElement("div");
        thumb.className = "hero-thumb";
        thumb.dataset.index = index;
        const img = document.createElement("img");
        img.src = src;
        thumb.appendChild(img);
        heroPool.appendChild(thumb);

        thumb.addEventListener("click",()=>{
          document.querySelectorAll(".hero-thumb").forEach(t=>t.classList.remove("hero-thumb-active"));
          thumb.classList.add("hero-thumb-active");
          const target = getTargetSlot();
          applyHeroDataToSlot(target, heroPoolData[index]);
        });
      };
      reader.readAsDataURL(file);
    });
    heroPoolFilesInput.value = "";
  });

  applyActiveFromOrder();
})();
</script>
</body>
</html>
